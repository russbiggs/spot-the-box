!function(e){var t={};function o(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(s,i,function(t){return e[t]}.bind(null,i));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);class s{constructor(e,t,o){this.data,this.emitter=o,this.status=t,this.elem=e,this.onClick=this.onClick.bind(this),this.elem.addEventListener("click",this.onClick)}onClick(){const e=document.querySelector(".btn-status--active");e&&e.classList.remove("btn-status--active"),this.elem.classList.add("btn-status--active");const t={...this.data,status:this.status};this.emitter.emit("data-update",t)}}class i{constructor(e){this.elem=document.querySelector(".js-btn-save"),this.emitter=e,this.active=!1,this.data=[],this.update=this.update.bind(this),this.onClick=this.onClick.bind(this),this.elem.addEventListener("click",this.onClick)}async onClick(){await fetch("https://khab7rvd6c.execute-api.us-east-1.amazonaws.com/dev/mailbox",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.data)}),this.data={},this.emitter.emit("data-save")}update(e){this.active||(this.active=!0,this.elem.disabled=!1),this.data=e}}var n=class{constructor(e){this.emitter=e,this.containerElem=document.querySelector(".js-data-entry-container");const t=document.querySelector(".js-btn-removed");this.removedBtn=new s(t,"removed",e);const o=document.querySelector(".js-btn-present");this.presentBtn=new s(o,"present",e);const n=document.querySelector(".js-btn-inoperable");this.inoperableBtn=new s(n,"inoperable",e),this.saveBtn=new i(e),this.collectionBoxInfo=document.querySelector(".js-collection-box-info"),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.update=this.update.bind(this)}update(e){const t=e.properties,o={outlet:t.OUTLETID,lat:e.geometry.coordinates[1],lng:e.geometry.coordinates[0]},s=document.querySelector(".btn-status--active");s&&s.classList.remove("btn-status--active");const i=document.querySelector(".collection-box-lobby-note");i.classList.add("collection-box-lobby-note--hidden"),"USPS COLLECTION BOX - PO LOBBY"==t.BUSNAME&&i.classList.remove("collection-box-lobby-note--hidden"),this.removedBtn.data=o,this.presentBtn.data=o,this.inoperableBtn.data=o,this.collectionBoxInfo.innerHTML=`<p>Outlet ID: ${t.OUTLETID}</p><p>Type: ${t.BUSNAME}</p><p>Address: ${t.ADDR1}</p>`}show(e){this.containerElem.classList.remove("data-entry-container--hidden"),this.update(e)}hide(){this.containerElem.classList.add("data-entry-container--hidden")}};class a{constructor(e){this.emitter=e,this.elem=document.querySelector(".js-btn-back"),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.onClick=this.onClick.bind(this),this.elem.addEventListener("click",this.onClick)}onClick(){this.emitter.emit("show-map"),this.hide()}show(){this.elem.classList.remove("btn-back--hidden")}hide(){this.elem.classList.add("btn-back--hidden")}}var c=class{constructor(){this.timeOut,this.elem=document.querySelector(".snack"),this.showSnack=this.showSnack.bind(this)}showSnack(){clearTimeout(this.timeOut),this.elem.classList.remove("snack--hidden"),this.elem.classList.add("snack--visible"),this.timeOut=setTimeout(()=>{this.elem.classList.remove("snack--visible"),setTimeout(()=>{this.elem.classList.add("snack--hidden")},500)},2500)}};var r=class{constructor(e){this.emitter=e,this.modal=document.querySelector(".js-modal"),this.background=document.querySelector(".js-modal__background"),this.title=document.querySelector(".modal-title"),this.body=document.querySelector(".js-modal__body"),this.continueBtn=document.querySelector(".js-modal-continue-btn"),this.aboutBtn=document.querySelector(".js-btn-about"),this.open=this.open.bind(this),this.close=this.close.bind(this),this.addEventListeners()}addEventListeners(){this.continueBtn.addEventListener("click",this.close),this.aboutBtn.addEventListener("click",this.open)}open(){this.modal.classList.add("modal--visible"),this.background.classList.add("modal__background--visible"),this.body.classList.add("modal__body--visible")}close(){this.modal.classList.remove("modal--visible"),this.background.classList.remove("modal__background--visible"),this.body.classList.remove("modal__body--visible"),this.emitter.emit("modal-close")}};const l="#004B87",d="#d7191c",u="#fdae61";{const e={all:b=b||new Map,on:function(e,t){var o=b.get(e);o&&o.push(t)||b.set(e,[t])},off:function(e,t){var o=b.get(e);o&&o.splice(o.indexOf(t)>>>0,1)},emit:function(e,t){(b.get(e)||[]).slice().map((function(e){e(t)})),(b.get("*")||[]).slice().map((function(o){o(e,t)}))}};let t=!1;const o=new r(e),s=new n(e),i=new a(e),v=new c(e);function h(){document.querySelector(".overview-container").classList.remove("overview-container--hidden")}e.on("point-select",s.show),e.on("point-select",(function(){document.querySelector(".overview-container").classList.add("overview-container--hidden")})),e.on("point-select",i.show),e.on("data-update",s.saveBtn.update),e.on("show-map",h),e.on("show-map",s.hide),e.on("data-save",h),e.on("data-save",s.hide),e.on("data-save",v.showSnack),e.on("data-save",i.hide),e.on("data-save",()=>{fetch("https://khab7rvd6c.execute-api.us-east-1.amazonaws.com/dev/mailbox").then(e=>e.json()).then(e=>{y.getSource("collection-box-surveyed-src").setData(e)})}),e.on("modal-close",p),mapboxgl.accessToken="pk.eyJ1IjoicnVzc2JpZ2dzIiwiYSI6ImNrZHg2am55ejE3aHYyeWtqOGtocjh4ejgifQ.Qg_LH8LUNchJZBPsqDme9g";const y=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-98.5795,39.8283],zoom:5,hash:!0});function m(e){y.flyTo({center:[e.coords.longitude,e.coords.latitude],zoom:12})}function p(){t||navigator.geolocation&&navigator.geolocation.getCurrentPosition(m),t=!0}y.addControl(new MapboxGeocoder({accessToken:mapboxgl.accessToken,mapboxgl:mapboxgl})),y.addControl(new mapboxgl.NavigationControl),y.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),y.on("load",(function(){y.addSource("collection-box-src",{type:"vector",url:"mapbox://mikelmaron.3ws9y5k1"}),y.addLayer({id:"collection-boxes",type:"circle",source:"collection-box-src","source-layer":"collection_box_trim_valid-0tbyft",paint:{"circle-stroke-color":l,"circle-stroke-width":["interpolate",["linear"],["zoom"],4,.1,9,.5,14,1,16,4],"circle-stroke-opacity":["interpolate",["linear"],["zoom"],4,.6,7,.8,14,.9],"circle-opacity":0,"circle-radius":["interpolate",["linear"],["zoom"],10,1,14,6,18,30]}}),fetch("https://spot-the-box.s3.amazonaws.com/reports.json").then(e=>e.json()).then(e=>{y.addSource("collection-box-surveyed-src",{type:"geojson",data:e});const t=["match",["get","status"],"removed",d,"inoperable",u,l];y.addLayer({id:"collection-boxes-surveyed",type:"circle",source:"collection-box-surveyed-src",paint:{"circle-color":t,"circle-radius":["interpolate",["linear"],["zoom"],7,4,14,6,18,30]},layout:{"circle-sort-key":["match",["get","status"],"removed",2,"present",1,0]}})}),y.on("mouseenter","collection-boxes-surveyed",(function(){y.getCanvas().style.cursor="pointer"})),y.on("mouseleave","collection-boxes-surveyed",(function(){y.getCanvas().style.cursor=""})),y.on("mouseenter","collection-boxes",(function(){y.getCanvas().style.cursor="pointer"})),y.on("mouseleave","collection-boxes",(function(){y.getCanvas().style.cursor=""})),y.on("click",(function(t){let o=y.queryRenderedFeatures(t.point,{layers:["collection-boxes-surveyed"]});if(o.length){const e=o[0],s=e.geometry.coordinates.slice(),i=e.properties.status,n=e.properties.outlet,a=parseFloat(e.properties.createdAt),c=new Date(1e3*a),r=`${c.getMonth()+1}-${c.getDate()}-${c.getFullYear()} ${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}`;for(;Math.abs(t.lngLat.lng-s[0])>180;)s[0]+=t.lngLat.lng>s[0]?360:-360;(new mapboxgl.Popup).setLngLat(s).setHTML(`<strong>Outlet ID: ${n}</strong><p>Status: ${i}</p><p>Surveyed on: ${r}</p>`).addTo(y)}else o=y.queryRenderedFeatures(t.point,{layers:["collection-boxes"]}),o.length&&e.emit("point-select",o[0])}))}));let g=!1;const f=document.cookie.split("; ");for(const e of f)"visited=True"==e&&(g=!0);g?p():(o.open(),document.cookie="visited=True; expires=Fri, 31 Dec 9999 23:59:59 GMT");"mediaDevices"in navigator&&console.log("media supported")}var b}]);